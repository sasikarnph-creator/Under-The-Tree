{% extends "layout.html" %}

{% block content %}
<div class="container py-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
      <li class="breadcrumb-item active">{{ product.name }}</li>
    </ol>
  </nav>

  <div class="row g-5">
    <div class="col-md-5">
      <div class="sticky-top" style="top: 100px;">
        <div class="card border-0 shadow-md" style="overflow: hidden; border-radius: 12px;">
          <img src="/{{ product.image }}" class="card-img-top w-100" alt="{{ product.name }}" style="height: 450px; object-fit: cover; background: var(--bg);">
        </div>
        <div class="mt-3 d-flex gap-2">
          <div class="flex-grow-1">
            <img src="/{{ product.image }}" class="img-thumbnail" alt="thumb" style="height: 80px; object-fit: cover; cursor: pointer;">
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-7">
      <h1 class="display-6 fw-bold mb-2">{{ product.name }}</h1>
      
      <div class="d-flex gap-2 align-items-center mb-3">
        <span class="badge bg-light text-dark fs-6">{{ product.category }}</span>
        <div class="text-warning small">
          <i class="bi bi-star-fill"></i>
          <i class="bi bi-star-fill"></i>
          <i class="bi bi-star-fill"></i>
          <i class="bi bi-star-fill"></i>
          <i class="bi bi-star-half"></i>
          <span class="text-muted ms-1">(42 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß)</span>
        </div>
      </div>

      <div class="border-top border-bottom py-3 mb-3">
        <div class="row">
          <div class="col-6 col-sm-3 mb-2">
            <small class="text-muted">‡∏£‡∏≤‡∏Ñ‡∏≤</small>
            <div class="h5 text-primary fw-bold">${{ '%.2f'|format(product.price) }}</div>
          </div>
          <div class="col-6 col-sm-3 mb-2">
            <small class="text-muted">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</small>
            <div class="h5">‚úì ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
          </div>
          <div class="col-6 col-sm-3 mb-2">
            <small class="text-muted">‡∏´‡∏°‡∏ß‡∏î</small>
            <div class="h5">{{ product.category }}</div>
          </div>
          <div class="col-6 col-sm-3 mb-2">
            <small class="text-muted">ID</small>
            <div class="h5">#{{ product.id }}</div>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <h5 class="mb-2">üìñ ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</h5>
        <p class="lead text-muted">{{ product.desc }}</p>
      </div>

      <div class="d-flex gap-2 mb-4">
        <div class="input-group" style="max-width: 150px;">
          <button class="btn btn-outline-secondary qty-btn" type="button" data-action="minus">‚àí</button>
          <input type="number" class="form-control text-center qty-input" value="1" min="1">
          <button class="btn btn-outline-secondary qty-btn" type="button" data-action="plus">+</button>
        </div>
        <button class="btn btn-success btn-lg add-to-cart-btn" data-id="{{ product.id }}">
          <i class="bi bi-cart-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        </button>
      </div>

      <div class="alert alert-light border-start border-4" style="border-color: var(--accent) !important;">
        <h6 class="mb-2">üí° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h6>
        <ul class="small mb-0">
          <li>‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ $20 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</li>
          <li>‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏≠‡πÉ‡∏à 100% ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</li>
          <li>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row mt-5">
    <div class="col-12">
      <h4 class="mb-3">üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏™‡∏ô‡πÉ‡∏à</h4>
    </div>
  </div>
</div>

<script>
document.querySelectorAll('.qty-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const input = this.closest('.input-group').querySelector('.qty-input');
    const current = parseInt(input.value);
    if (this.dataset.action === 'plus') {
      input.value = current + 1;
    } else if (current > 1) {
      input.value = current - 1;
    }
  });
});

document.querySelector('.add-to-cart-btn').addEventListener('click', function() {
  const qty = parseInt(document.querySelector('.qty-input').value);
  const pid = this.dataset.id;
  for (let i = 0; i < qty; i++) {
    fetch('/api/add', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ product_id: pid })
    }).then(r => r.json()).catch(console.error);
  }
  alert(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${qty} ‡πÄ‡∏•‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!`);
});
</script>

{% endblock %}
